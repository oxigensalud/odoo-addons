<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="report_trial_balance_consolidated">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="account_financial_report.internal_layout">
                    <t t-call="oxigen_account.report_trial_balance_base" />
                </t>
            </t>
        </t>
    </template>
    <template id="report_trial_balance_base">
        <t t-set="foreign_currency" t-value="foreign_currency" />
        <t t-set="show_hierarchy_level" t-value="show_hierarchy_level" />
        <t t-set="limit_hierarchy_level" t-value="limit_hierarchy_level" />
        <t t-set="merge_companies" t-value="merge_companies" />
        <!-- Defines global variables used by internal layout -->
        <t t-set="title">
            Trial Balance
        </t>
        <t t-set="company_name" t-value="Company_Name" />
        <t class="page">
            <div class="row">
                <h4
                    class="mt0"
                    t-esc="title or 'Odoo Report'"
                    style="text-align: center;"
                />
            </div>
            <!-- Display filters -->
            <t t-call="account_financial_report.report_trial_balance_filters" />
            <div class="act_as_table list_table" style="margin-top: 10px;" />
            <!-- Display account lines -->

            <div class="act_as_table data_table" style="width: 100%;">
                <!-- Display account header -->
                <t
                    t-call="account_financial_report.report_trial_balance_lines_header"
                />
                <!-- Display each lines -->
                <t t-foreach="trial_balance" t-as="balance">
                    <!-- Adapt -->
                    <t t-set="style" t-value="'font-size:12px;'" />
                    <t t-if="show_hierarchy">
                        <t t-if="balance['type'] == 'group_type'">
                            <t
                                t-set="style"
                                t-value="style + 'font-weight: bold; color: blue;'"
                            />
                        </t>
                        <t t-if="limit_hierarchy_level">
                            <t
                                t-if="show_hierarchy_level > balance['level'] and (not hide_parent_hierarchy_level or (show_hierarchy_level - 1) == balance['level'])"
                            >
                                <t
                                    t-call="account_financial_report.report_trial_balance_line"
                                />
                            </t>
                        </t>
                        <t t-if="not limit_hierarchy_level">
                            <t
                                t-call="account_financial_report.report_trial_balance_line"
                            />
                        </t>
                    </t>
                    <t t-else="">
                        <t
                            t-call="account_financial_report.report_trial_balance_line"
                        />
                    </t>
                </t>
            </div>
        </t>
    </template>
    <template id="account_financial_report.report_trial_balance_filters">
        <div class="act_as_table data_table" style="width: 100%;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Date range filter</div>
                <div class="act_as_cell">Target moves filter</div>
                <div class="act_as_cell">Limit hierarchy levels</div>
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    From:
                    <span t-esc="date_from" t-options="{'widget': 'date'}" />
                    To
                    <span t-esc="date_to" t-options="{'widget': 'date'}" />
                </div>
                <div class="act_as_cell">
                    <t t-if="only_posted_moves">All posted entries</t>
                    <t t-if="not only_posted_moves">All entries</t>
                </div>
                <div class="act_as_cell">
                    <t t-if="limit_hierarchy_level">
                        Level
                        <span t-esc="show_hierarchy_level" />
                    </t>
                    <t t-if="not limit_hierarchy_level">No limit</t>
                </div>
            </div>
        </div>
    </template>
    <template id="account_financial_report.report_trial_balance_lines_header">
        <!-- Display table headers for lines -->
        <div class="act_as_thead">
            <div class="act_as_row labels">
                <!--## Code-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{6 if not merge_companies else 8}}%;"
                >Code</div>
                <!--## Account-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{22 if not merge_companies else 25}}%;"
                >Account</div>
                <!--## Company-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: 9%;"
                    t-if="not merge_companies"
                >Company</div>
                <!--## Initial balance-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{7 if not merge_companies else 9}}%;"
                >
                    Initial
                    balance
                </div>
                <!--## Debit-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{7 if not merge_companies else 9}}%;"
                >Debit</div>
                <!--## Credit-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{7 if not merge_companies else 9}}%;"
                >Credit</div>
                <!--## Period balance-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{7 if not merge_companies else 9}}%;"
                >Period balance</div>
                <!--## Ending balance-->
                <div
                    class="act_as_cell"
                    t-attf-style="width: {{7 if not merge_companies else 9}}%;"
                >Ending balance</div>
                <t t-if="foreign_currency">
                    <!--## amount_currency-->
                    <div
                        class="act_as_cell"
                        t-attf-style="width: {{9 if not merge_companies else 11}}%;"
                    >Initial
                        balance cur.</div>
                    <div
                        class="act_as_cell"
                        t-attf-style="width: {{9 if not merge_companies else 11}}%;"
                    >Ending balance
                        cur.</div>
                </t>
            </div>
        </div>
    </template>
    <template id="account_financial_report.report_trial_balance_line">
        <t
            t-set="aml_domain_common"
            t-if="only_posted_moves"
            t-value="[('parent_state', '=', 'posted')]"
        />
        <t
            t-set="aml_domain_common"
            t-else=""
            t-value="[('parent_state', 'in', ('posted', 'draft'))]"
        />
        <!-- # line -->
        <div class="act_as_row lines">
                <!--## Code-->
            <t t-if="balance['type'] == 'account_type'">
                <div class="act_as_cell left" t-att-style="style">
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.account"
                        view-type="form"
                    >
                        <t t-esc="balance['code']" />
                    </span>
                </div>
                <!--            ## Account/Partner-->
                <div class="act_as_cell left" t-att-style="style">
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.account"
                        view-type="form"
                    >
                        <t t-esc="balance['name']" />
                    </span>
                </div>
                <div
                    class="act_as_cell left"
                    t-att-style="style"
                    t-if="not merge_companies"
                >
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.account"
                        view-type="form"
                    >
                        <t t-esc="balance['company']" />
                    </span>
                </div>
            </t>
            <t t-if="balance['type'] == 'group_type'">
                <div class="act_as_cell left" t-att-style="style">
                    <t t-set="res_model" t-value="'account.group'" />
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.group"
                        view-type="form"
                    >
                        <t t-raw="balance['code']" />
                    </span>
                </div>
                <div class="act_as_cell left" t-att-style="style">
                    <t t-set="res_model" t-value="'account.group'" />
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.group"
                        view-type="form"
                    >
                        <t t-esc="balance['name']" />
                    </span>
                </div>
                <div
                    class="act_as_cell left"
                    t-att-style="style"
                    t-if="not merge_companies"
                >
                    <t t-set="res_model" t-value="'account.group'" />
                    <span
                        t-att-res-id="balance['id']"
                        res-model="account.group"
                        view-type="form"
                    >
                        <t t-esc="balance['company']" />
                    </span>
                </div>
            </t>
            <!--## Initial balance-->
            <div class="act_as_cell amount" t-att-style="style">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&lt;', date_from)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                            ('date', '&lt;', date_from)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-esc="balance['initial_balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['account_ids']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&lt;', date_from)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['account_ids']),
                            ('date', '&lt;', date_from)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-raw="balance['initial_balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
            </div>
            <!--## Debit-->
            <div class="act_as_cell amount" t-att-style="style">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('debit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('debit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-esc="balance['debit']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('debit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('debit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-raw="balance['debit']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
            </div>
            <!--            &lt;!&ndash;## Credit&ndash;&gt;-->
            <div class="act_as_cell amount" t-att-style="style">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('credit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('credit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-esc="balance['credit']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('credit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('credit', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-raw="balance['credit']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>

            </div>
            <!--            &lt;!&ndash;## Period balance&ndash;&gt;-->
            <div class="act_as_cell amount" t-att-style="style">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('balance', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to),
                                ('balance', '&lt;&gt;', 0)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-esc="balance['balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']),
                                ('date', '&gt;=', date_from),
                                ('date', '&lt;=', date_to)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-raw="balance['balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
            </div>
            <!--            &lt;!&ndash;## Ending balance&ndash;&gt;-->
            <div class="act_as_cell amount" t-att-style="style">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('parent_state', '=', 'posted'),
                                ('date', '&lt;=', date_to)]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', '=', balance['id']),
                                ('date', '&lt;=', date_to)]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-esc="balance['ending_balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <t t-if="only_posted_moves">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids']), ('parent_state', '=', 'posted')]"
                        />
                    </t>
                    <t t-else="">
                        <t
                            t-set="domain"
                            t-value="[('account_id', 'in', balance['account_ids'])]"
                        />
                    </t>
                    <span
                        t-att-domain="domain+aml_domain_common"
                        res-model="account.move.line"
                    >
                        <t
                            t-raw="balance['ending_balance']"
                            t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"
                        />
                    </span>
                </t>

            </div>
            <t t-if="foreign_currency">
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="balance['currency_id']">
                        <t
                            t-set="balance_currency"
                            t-value="currency_model.browse(balance['currency_id'])"
                        />
                        <!--## Initial balance cur.-->
                        <div class="act_as_cell amount" t-att-style="style">
                            <t t-if="only_posted_moves">
                                <t
                                    t-set="domain"
                                    t-value="[('account_id', '=', balance['id']), ('parent_state', '=', 'posted')]"
                                />
                            </t>
                            <t t-else="">
                                <t
                                    t-set="domain"
                                    t-value="[('account_id', '=', balance['id'])]"
                                />
                            </t>
                            <span
                                t-att-domain="domain+aml_domain_common"
                                res-model="account.move.line"
                            >
                                <t
                                    t-esc="balance['initial_currency_balance']"
                                    t-options="{'widget': 'monetary', 'display_currency': balance_currency}"
                                />
                            </span>
                        </div>
                    </t>
                </t>
                <!--## Ending balance cur.-->
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="balance['currency_id']">
                        <div class="act_as_cell amount" t-att-style="style">
                            <t t-if="only_posted_moves">
                                <t
                                    t-set="domain"
                                    t-value="[('account_id', '=', balance['id']), ('parent_state', '=', 'posted')]"
                                />
                            </t>
                            <t t-else="">
                                <t
                                    t-set="domain"
                                    t-value="[('account_id', '=', balance['id'])]"
                                />
                            </t>
                            <span
                                t-att-domain="domain+aml_domain_common"
                                res-model="account.move.line"
                            >
                                <t
                                    t-raw="balance['ending_currency_balance']"
                                    t-options="{'widget': 'monetary', 'display_currency': balance_currency}"
                                />
                            </span>
                        </div>
                    </t>
                </t>
                <t t-if="balance['type'] == 'account_type'">
                    <t t-if="not balance['currency_id']">
                        <!--## balance_currency-->
                        <div class="act_as_cell" />
                        <div class="act_as_cell" />
                    </t>
                </t>
                <t t-if="balance['type'] == 'group_type'">
                    <!--## balance_currency-->
                    <div class="act_as_cell" />
                    <div class="act_as_cell" />
                </t>
            </t>
        </div>
    </template>
</odoo>
